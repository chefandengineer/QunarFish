<!DOCTYPE HTML>
<!--
	Miniport 1.0 by HTML5 Up!
	html5up.net | @n33co
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>Transportation Sentiment</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<meta name="description" content="" />
		<meta name="keywords" content="" />
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300,600,700" rel="stylesheet" />
		<link href="css/menu_assets/styles.css" rel="stylesheet" type="text/css">
		<script src="js/jquery-1.8.3.min.js"></script>
		<script src="css/5grid/init.js?use=mobile,desktop,1000px"></script>
		<script src="js/init.js"></script>
		<script src="js/d3.js"></script>
		<script src="js/d3.layout.cloud.js"></script>
		<script src="http://cdn.leafletjs.com/leaflet-0.5/leaflet.js"></script>

		<script src="js/persist.js"></script >
	    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5/leaflet.css" />
		<!--For the starting charts-->
		
		<script src="http://code.highcharts.com/highcharts.js"></script>
		<script src="js/home-charts.js"></script>
		<script src="js/theme/gray.js"></script>
		<script src="js/wordcloud.js"></script>
		<script src="http://code.highcharts.com/modules/exporting.js"></script>
		<!-- For the map information,using leaflet as a the function -->
	

		 <!-- For the checkbox -->
		 <LINK rel="stylesheet" type="text/css" href="css/checkbox/style.css">

		<script language="javascript">
		//Gnerate a dynamic chart
		$(function () { 
	//		$('#container').highcharts(map_charts)});
		//	loadMapPage();

		</script>

		<noscript>
			<link rel="stylesheet" href="css/5grid/core.css" />
			<link rel="stylesheet" href="css/5grid/core-desktop.css" />
			<link rel="stylesheet" href="css/5grid/core-1200px.css" />
			<link rel="stylesheet" href="css/5grid/core-noscript.css" />
			<link rel="stylesheet" href="css/style.css" />
			<link rel="stylesheet" href="css/style-desktop.css" />
		</noscript>
		
	</head>
	<body class="has-js">
	    <!-- Menu Bar-->
	   	<div id='cssmenu'>
			<ul style="margin: 0 auto;width:40%;">
   			 <li class='active'><a href='http://transportation.heinz.cmu.edu/index.html'><span>Home</span></a></li>
   			 <li class='has-sub'><a href='#'><span>condition</span></a>
      		<ul>
           <li><a href='#'><span>Location</span></a></li>
           <li class='last'><a href='#'><span>Topic</span></a></li>
          </ul>
         </li>
         <li><a href='#'><span>Map</span></a></li>
         <li class='last'><a href='#'><span>Contact</span></a></li>
         </ul> 
      </div>

		<!--End of Menu Bar-->
	

	
		<!-- Top List Section -->
	<div class="wrapper wrapper-style2"> 
		<article id="work">
			<!--Redenring the Map-->
			<div class="5grid-layout">
				<br></br>

				<div class="row">
							<div class="line horizontal"></div>
				</div>
				<div class="row">
					<div class="10u">
						<div id="map" style="border-radius: 10px; -webkit-border-radius: 10px; -moz-border-radius: 10px; -khtml-border-radius: 10px; box-shadow: 0 5px 12px rgba(0,0,0,.4); -webkit-box-shadow: 0 5px 12px rgba(0,0,0,.4); -moz-box-shadow: 0 5px 12px rgba(0,0,0,.4); -khtml-box-shadow: 0 5px 12px rgba(0,0,0,.4);"></div>
					</div>
					<div class="2u">
    						<FORM action="#" method="get" accept-charset="utf-8">
    							<h4>Topics</h4>
        						<FIELDSET class="radios">
            					<LABEL class="label_radio r_on" for="radio-01">
            						<INPUT name="sample-radio" id="radio-01" value="1" type="radio" checked="" onclick="setView(1)"><div id="label1"> </div></LABEL>
            					<LABEL class="label_radio r_on" for="radio-02"><INPUT name="sample-radio" id="radio-02" value="1" type="radio" checked="" onclick="setView(2)"><div  id="label2"> </div></LABEL>
            					<LABEL class="label_radio r_on" for="radio-03"><INPUT name="sample-radio" id="radio-03" value="1" type="radio" checked="" onclick="setView(3)"> <div  id="label3"> </div></LABEL>
            					<LABEL class="label_radio r_on" for="radio-04"><INPUT name="sample-radio" id="radio-04" value="1" type="radio" checked="" onclick="setView(4)"> <div  id="label4"> </div></LABEL>
            					<LABEL class="label_radio r_on" for="radio-05"><INPUT name="sample-radio" id="radio-05" value="1" type="radio" checked="" onclick="setView(5)"> <div  id="label5"> </div></LABEL>
            					<LABEL class="label_radio r_on" for="radio-06"><INPUT name="sample-radio" id="radio-06" value="1" type="radio" checked="" onclick="setView(6)"> <div  id="label6"> </div></LABEL>
            					<LABEL class="label_radio r_on" for="radio-07"><INPUT name="sample-radio" id="radio-07" value="1" type="radio" checked="" onclick="setView(7)"><div  id="label7"> </div></LABEL>
            					<LABEL class="label_radio r_on" for="radio-08"><INPUT name="sample-radio" id="radio-08" value="1" type="radio" checked="" onclick="setView(8)"> <div  id="label8"> </div></LABEL>
            					<LABEL class="label_radio r_on" for="radio-09"><INPUT name="sample-radio" id="radio-09" value="1" type="radio" checked="" onclick="setView(9)"> <div  id="label9"> </div></LABEL>
            					<LABEL class="label_radio r_on" for="radio-10"><INPUT name="sample-radio" id="radio-10" value="1" type="radio" checked="" onclick="setView(10)"> <div  id="label10"> </div> </LABEL>
        						</FIELDSET>
 			   				</FORM>
				</div>		
			</div>
				<div class="row">
				<div class="line horizontal"></div>
				</div>
			<div class="row">
			<!--
				<div class="8u">
					<div id="container" style="min-width: 250px; height: 250px; margin: 0 auto;
											border-right:solid;border-right-width:1px;border-right-color:rgba(0,0,0,0.15);"></div>
				</div>
				<div class="4u" id="wordcloud"></div>
			-->
			</div>
		</div>	
		</article>
	</div>



		<!-- Contact -->
		<div class="wrapper wrapper-style4">
					<footer>
						<p class="contact" style=" font-size: 90%">
							&copy; 2013 Carnegie Mellon University | Images: <a href="http://fotogrph.com">Heinz</a> + <a href="http://iconify.it">College</a> | Design: <a href="http://html5up.net/">Special Thanks to HTML5 Up!</a>
						</p>
					</footer>
			</div>
	</body>
	<script language="javascript">
	var map = L.map('map').setView([51.505, -0.09], 11	);
	var geocodes = {};
	//var map = L.map ('map')hasOwnProperty;
		L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>'
		}).addTo(map);


//		L.marker([51.5, -0.09]).addTo(map)
//			.bindPopup("<b>check the sentiment</b><br /> Transportation.").openPopup();
//
//		L.circle([51.508, -0.11], 500, {
//			color: 'red',
//			fillColor: '#f03',
//			fillOpacity: 0.5
//		}).addTo(map).bindPopup("I am a circle.");

//		L.polygon([
//			[51.509, -0.08],
//			[51.503, -0.06],
//			[51.51, -0.047]
//		]).addTo(map).bindPopup("I am a polygon.");


		var popup = L.popup();

		function onMapClick(e) {
			popup
				.setLatLng(e.latlng)
				.setContent("You clicked the map at " + e.latlng.toString())
				.openOn(map);
		}

		map.on('click', onMapClick);

    function setupLabel() {
        if ($('.label_check input').length) {
            $('.label_check').each(function(){ 
                $(this).removeClass('c_on');
            });
            $('.label_check input:checked').each(function(){ 
                $(this).parent('label').addClass('c_on');
            });                
        };
        if ($('.label_radio input').length) {
            $('.label_radio').each(function(){ 
                $(this).removeClass('r_on');
            });
            $('.label_radio input:checked').each(function(){ 
                $(this).parent('label').addClass('r_on');
            });
        };
    };
    $(document).ready(function(){
        $('.label_check, .label_radio').click(function(){
            setupLabel();
        });
        setupLabel(); 
    });

    var mapfile = domain + 'data/2013-02/2013-02-06_0_topic.json';
	var loadMapPage = function(){
    
    //Get the current file
       
    //Update the information 
        $.getJSON(mapfile,
                 function(data) {
               //TODO 
        //Data should be narrowed to a daily
        //The page will display the data for a day only        //TODO 
        //Set up the topic selection box for a day 
        setTopicSelection(data);
        //Set Up the information
        for(var key in data){
            buildMapData(data[key]);
            break;
        }
        });
}

var setTopicSelection = function(data){
    //Generate the list of topics
    // build an array of topics, size of 10
    //Set up the select box 
    var texts = {};
    for(var i = 0; i < 10; i++){
        //Set up the select box
        var text = data[i]["distribution"][0][0];
        var index = 1;
        while(texts.hasOwnProperty(text)){
        	text = data[i]["distribution"][index][0];
        	index++;
        }
        //update the texts 
    	texts[text] = 1;
        //console.log(text);
        var labelid = "#label" + (i + 1);
        $(labelid).text(text);
        //Set up the marker
       	var geolocations = data[i]["geolocation"];
       	setTheMarker(geolocations,text,i);
    }
}


var setTheMarker = function(geolocations,text,i){
       var url = "http://maps.googleapis.com/maps/api/geocode/json?address="+ geolocations[0] + ",+" + geolocations[1] + ",+" + geolocations[2] + "&sensor=false";
            $.get(url,function(data){
                //Parse the returned json and perform actions correspondently 
                var status  = data["status"];
                if(status == 'OK'){
                    //Get the lat and lng code 
                    var lat = data["results"][0]["geometry"]["location"]["lat"];
                    var lng = data["results"][0]["geometry"]["location"]["lng"];
                    geocodes[i] = [lat,lng,geolocations[0],geolocations[1],text];
                    //Set up the marker
                 	L.marker([lat, lng]).addTo(map).bindPopup("Location: " + geolocations[0] + "," + geolocations[1] + "<br>" + "Topic: " + text).openPopup();
                 	map.setView([lat,lng],11);
                }
            });
}
var setView = function(index){
	var lat = geocodes[index-1][0];
	var lng = geocodes[index-1][1];
	var geolocations1 = geocodes[index-1][2];
	var geolocations2 = geocodes[index-1][3];
	var text = geocodes[index-1][4];
	L.marker([lat, lng]).addTo(map).bindPopup("Location: " + geolocations1 + "," + geolocations2 + "<br>" + "Topic: " + text).openPopup();
    map.setView([lat,lng],11);
}


$(function () { loadMapPage();});
</script>

</html>
